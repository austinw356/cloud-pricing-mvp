<!DOCTYPE html>
index.html
<html>
<head>
  <meta charset="utf-8" />
  <title>Magalu Cloud Pricing Calculator (Test)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px auto;
      max-width: 1000px;
      background: #f4f4f4;
      padding: 20px;
    }
    h1 {
      margin-bottom: 8px;
    }
    .disclaimer {
      font-size: 0.9em;
      color: #555;
      margin-bottom: 20px;
    }
    .card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .card h2 {
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 1.2em;
      color: #333;
    }
    .field {
      margin-bottom: 16px;
    }
    label {
      display: inline-block;
      width: 220px;
      font-weight: bold;
      margin-bottom: 6px;
    }
    select, input[type="number"] {
      min-width: 150px;
      padding: 4px;
    }
    button {
      margin-top: 8px;
      padding: 6px 12px;
      cursor: pointer;
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
    }
    button:hover {
      background: #0056b3;
    }
    .disabled {
      background-color: #ccc !important;
      cursor: not-allowed;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f9f9f9;
    }
    td button {
      background: #dc3545;
    }
    td button:hover {
      background: #a71d2a;
    }
    .totals-section {
      margin-top: 20px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 16px;
    }
    .totals-section h3 {
      margin-top: 0;
      margin-bottom: 10px;
    }
    .totals-section p {
      margin: 0;
      padding: 4px 0;
    }
    .totals-section p span {
      float: right;
    }
  </style>
</head>
<body>

  <h1>Magalu Cloud Pricing Calculator (Test)</h1>
  <p class="disclaimer">
    Prices shown are monthly estimates (billed by the second). Taxes included.
  </p>

  <div class="card">
    <h2>Add a New Resource</h2>

    <!-- Resource Type: VM or Object Storage -->
    <div class="field">
      <label for="resourceType">Resource Type:</label>
      <select id="resourceType">
        <option value="VM" selected>Virtual Machines</option>
        <option value="ObjectStorage">Object Storage</option>
      </select>
    </div>

    <!-- =============== VIRTUAL MACHINE FIELDS =============== -->
    <div id="vmFields">
      <!-- Performance Class -->
      <div class="field">
        <label for="perfClass">Performance Class:</label>
        <select id="perfClass">
          <option value="BV">Balanced Value (BV)</option>
          <option value="DP">Dedicated Performance (DP)</option>
        </select>
      </div>

      <!-- OS Type -->
      <div class="field">
        <label for="osType">OS Type:</label>
        <select id="osType">
          <option value="Linux">Linux</option>
          <option value="Windows">Windows (+R$150/vCPU)</option>
        </select>
      </div>

      <!-- Memory Ratio -->
      <div class="field">
        <label for="memoryRatio">Memory Ratio (RAM / vCPU):</label>
        <select id="memoryRatio">
          <!-- Will update dynamically -->
        </select>
      </div>

      <!-- vCPUs -->
      <div class="field">
        <label for="vcpus">VM Size (# of vCPUs):</label>
        <select id="vcpus">
          <!-- Will update dynamically -->
        </select>
      </div>

      <!-- Local Disk -->
      <div class="field">
        <label for="localDisk">Local Disk Size (GiB):</label>
        <select id="localDisk">
          <!-- Will update dynamically -->
        </select>
      </div>

      <!-- GPU -->
      <div class="field">
        <label for="gpu">Optional GPU:</label>
        <select id="gpu">
          <option value="0">No GPU</option>
          <option value="1">1x Nvidia L40 (+R$5110)</option>
          <option value="2">2x Nvidia L40 (+R$10220)</option>
        </select>
        <span id="gpuNote" style="color: #d00; margin-left: 10px;"></span>
      </div>
    </div>

    <!-- =============== OBJECT STORAGE FIELDS =============== -->
    <div id="storageFields" style="display: none;">
      <div class="field">
        <label for="storageClass">Storage Class:</label>
        <select id="storageClass">
          <option value="Standard" selected>Standard (R$0.10/GB)</option>
          <option value="ColdInstant">Cold Instant (R$0.06/GB + R$0.10/GB retrieval)</option>
        </select>
      </div>
      <div class="field">
        <label for="storageGiB"># of GiBs Stored:</label>
        <input type="number" id="storageGiB" value="500" min="1" />
      </div>
      <div class="field">
        <label for="retrievedGiB">GiBs Retrieved per Month:</label>
        <input type="number" id="retrievedGiB" value="100" min="0" />
      </div>
    </div>

    <!-- Shared quantity field (applies to both VM and Storage) -->
    <div class="field">
      <label for="quantity">Quantity of Instances:</label>
      <input type="number" id="quantity" value="1" min="1" />
    </div>

    <button id="addResourceBtn">Add This Configuration</button>
  </div>

  <!-- =============== TABLE OF ADDED RESOURCES =============== -->
  <table id="instancesTable">
    <thead>
      <tr>
        <th>Resource Type</th>
        <th>SKU / Details</th>
        <th>Qty</th>
        <th>Subtotal (R$)</th>
        <th>Remove</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rows added dynamically -->
    </tbody>
  </table>

  <!-- =============== SUMMARY / TOTALS SECTION =============== -->
  <div class="totals-section" id="totalsSection">
    <h3>Summary</h3>

    <!-- VMs -->
    <p>**Virtual Machines**</p>
    <p>Total vCPUs: <span id="vmTotalVcpus">0</span></p>
    <p>Total RAM (GB): <span id="vmTotalRam">0</span></p>
    <p>Total VM Cost: <span id="vmTotalCost">R$0.00</span></p>

    <!-- Object Storage -->
    <br />
    <p>**Object Storage**</p>
    <p>Total GB Stored: <span id="storageTotalGiB">0</span></p>
    <p>Total GB Retrieved: <span id="storageTotalRetrieved">0</span></p>
    <p>Total Storage Cost: <span id="storageTotalCost">R$0.00</span></p>

    <br />
    <p><strong>Total Monthly Cost:</strong> <span id="grandTotalCost">R$0.00</span></p>
  </div>

  <script>
    // ----------------------------------------------------------------
    // A) Data & Pricing
    // ----------------------------------------------------------------

    // Balanced Value (BV) or Dedicated Performance (DP)
    const memoryRatiosBV = [1, 2, 4];
    const memoryRatiosDP = [2, 4, 8];
    const vcpusBV = [1, 2, 4, 8];
    const vcpusDP = [2, 4, 8, 16, 32];

    // Local disk options:
    // BV + Linux => [10, 20, 40, 100]
    // BV + Windows => [40, 80, 160]
    // DP (Linux or Windows) => [100, 150, 250]
    function getLocalDiskOptions(perfClass, os) {
      if (perfClass === 'BV') {
        if (os === 'Linux') {
          return [10, 20, 40, 100];
        } else {
          return [40, 80, 160];
        }
      } else {
        // DP
        return [100, 150, 250];
      }
    }

    // ----------------------------------------------------------------
    // B) DOM Elements
    // ----------------------------------------------------------------
    const resourceTypeEl  = document.getElementById('resourceType');

    // VM fields
    const vmFieldsEl      = document.getElementById('vmFields');
    const perfClassEl     = document.getElementById('perfClass');
    const osTypeEl        = document.getElementById('osType');
    const memoryRatioEl   = document.getElementById('memoryRatio');
    const vcpusEl         = document.getElementById('vcpus');
    const localDiskEl     = document.getElementById('localDisk');
    const gpuEl           = document.getElementById('gpu');
    const gpuNoteEl       = document.getElementById('gpuNote');

    // Object Storage fields
    const storageFieldsEl = document.getElementById('storageFields');
    const storageClassEl  = document.getElementById('storageClass');
    const storageGiBEl    = document.getElementById('storageGiB');
    const retrievedGiBEl  = document.getElementById('retrievedGiB');

    // Shared
    const quantityEl      = document.getElementById('quantity');
    const addResourceBtn  = document.getElementById('addResourceBtn');
    const instancesTableBody = document.querySelector('#instancesTable tbody');

    // Totals section
    const vmTotalVcpusEl  = document.getElementById('vmTotalVcpus');
    const vmTotalRamEl    = document.getElementById('vmTotalRam');
    const vmTotalCostEl   = document.getElementById('vmTotalCost');
    const storageTotalGiBEl = document.getElementById('storageTotalGiB');
    const storageTotalRetrievedEl = document.getElementById('storageTotalRetrieved');
    const storageTotalCostEl = document.getElementById('storageTotalCost');
    const grandTotalCostEl = document.getElementById('grandTotalCost');

    // Data store for all added resources
    let instances = [];

    // ----------------------------------------------------------------
    // C) Show/Hide fields based on Resource Type
    // ----------------------------------------------------------------
    function updateResourceTypeUI() {
      const selectedType = resourceTypeEl.value;

      if (selectedType === 'VM') {
        vmFieldsEl.style.display = 'block';
        storageFieldsEl.style.display = 'none';
      } else {
        vmFieldsEl.style.display = 'none';
        storageFieldsEl.style.display = 'block';
      }
    }

    resourceTypeEl.addEventListener('change', updateResourceTypeUI);

    // ----------------------------------------------------------------
    // D) VM Form Field Updates
    // ----------------------------------------------------------------
    function updateVMFields() {
      const currentPerfClass = perfClassEl.value;
      const currentOS = osTypeEl.value;

      // Memory Ratios
      let ratios = (currentPerfClass === 'BV') ? memoryRatiosBV : memoryRatiosDP;
      memoryRatioEl.innerHTML = '';
      ratios.forEach(r => {
        const opt = document.createElement('option');
        opt.value = r;
        opt.textContent = r;
        memoryRatioEl.appendChild(opt);
      });

      // vCPUs
      let vcpuOpts = (currentPerfClass === 'BV') ? vcpusBV : vcpusDP;
      vcpusEl.innerHTML = '';
      vcpuOpts.forEach(v => {
        const opt = document.createElement('option');
        opt.value = v;
        opt.textContent = v;
        vcpusEl.appendChild(opt);
      });

      // Local Disk
      let diskOpts = getLocalDiskOptions(currentPerfClass, currentOS);
      localDiskEl.innerHTML = '';
      diskOpts.forEach(d => {
        const opt = document.createElement('option');
        opt.value = d;
        opt.textContent = d;
        localDiskEl.appendChild(opt);
      });

      // GPU logic:
      // disable if DP or OS=Windows
      let disableGPU = false;
      let note = '';
      if (currentPerfClass === 'DP') {
        disableGPU = true;
        note = 'GPU not available on this performance class';
      } else if (currentOS === 'Windows') {
        disableGPU = true;
        note = 'GPU not available with Windows';
      }
      gpuEl.disabled = disableGPU;
      if (disableGPU) {
        gpuEl.value = '0';
        gpuNoteEl.textContent = note;
      } else {
        gpuNoteEl.textContent = '';
      }
    }

    perfClassEl.addEventListener('change', updateVMFields);
    osTypeEl.addEventListener('change', updateVMFields);

    // also if storageClass changes, hide or show retrieval input
    storageClassEl.addEventListener('change', () => {
      if (storageClassEl.value === 'Standard') {
        // no retrieval fees
        retrievedGiBEl.disabled = true;
        retrievedGiBEl.value = 0; 
      } else {
        retrievedGiBEl.disabled = false;
        if (parseInt(retrievedGiBEl.value, 10) === 0) {
          retrievedGiBEl.value = 100; // default if it was 0
        }
      }
    });

    // Init
    updateResourceTypeUI();
    updateVMFields();

    // ----------------------------------------------------------------
    // E) Cost Calculations
    // ----------------------------------------------------------------

    // VM cost formula:
    //   basePrice = 35 for 1 vCPU + ratio=1, BV, Linux, zero disk, zero GPU
    //   perfClassFactor = 1 for BV, 1.5 for DP
    //   totalCompute = basePrice * perfClassFactor * vcpus * memRatio
    //   Windows surcharge = 150 * vcpus
    //   disk cost = (diskSize / 10) * 8
    //   GPU cost = 5110 * gpus
    //   => total for 1 instance => sum all above
    //   => multiply by quantity
    function calculateVMCost(perfClass, memRatio, vcpus, os, diskSize, gpuCount, quantity) {
      const basePrice = 35;
      const perfClassFactor = (perfClass === 'BV') ? 1 : 1.5;
      const memoryRatioFactor = parseInt(memRatio, 10);
      const numVcpus = parseInt(vcpus, 10);
      const numDiskGiB = parseInt(diskSize, 10);
      const gpus = parseInt(gpuCount, 10);
      const qty = parseInt(quantity, 10);

      // compute cost
      let computeCost = basePrice * perfClassFactor * numVcpus * memoryRatioFactor;
      // windows surcharge
      let osSurcharge = (os === 'Windows') ? 150 * numVcpus : 0;
      // disk cost => R$8 per 10 GiB
      let diskCost = (numDiskGiB / 10) * 8;
      // gpu cost
      let gpuCost = 5110 * gpus;

      let total = (computeCost + osSurcharge + diskCost + gpuCost) * qty;
      return total;
    }

    // Object Storage cost formula:
    //   If Standard => cost = R$0.10 * GiBs stored
    //                  retrieval cost = 0
    //   If ColdInstant => cost = R$0.06 * GiBs stored
    //                     retrieval cost = R$0.10 * GiBs retrieved
    //   Multiply total by quantity
    function calculateStorageCost(storageClass, storedGiB, retrievedGiB, quantity) {
      const qty = parseInt(quantity, 10);
      const sGiB = parseInt(storedGiB, 10);
      const rGiB = parseInt(retrievedGiB, 10);

      let perGbStoragePrice = (storageClass === 'Standard') ? 0.10 : 0.06;
      let perGbRetrieval = (storageClass === 'Standard') ? 0 : 0.10;

      let total = ( (sGiB * perGbStoragePrice) + (rGiB * perGbRetrieval) ) * qty;
      return total;
    }

    // ----------------------------------------------------------------
    // F) Adding a Resource & Rendering the Table
    // ----------------------------------------------------------------
    function addResource() {
      const rType = resourceTypeEl.value;
      const qty = parseInt(quantityEl.value, 10);

      if (rType === 'VM') {
        // gather VM fields
        const perfClassVal = perfClassEl.value;
        const osVal = osTypeEl.value;
        const memRatioVal = memoryRatioEl.value;
        const vcpusVal = vcpusEl.value;
        const diskVal = localDiskEl.value;
        const gpuVal = gpuEl.value;

        // cost
        const subtotal = calculateVMCost(
          perfClassVal, memRatioVal, vcpusVal, osVal, diskVal, gpuVal, qty
        );

        // details
        const ramGB = parseInt(vcpusVal, 10) * parseInt(memRatioVal, 10);
        const sku = [
          'VM',
          perfClassVal,
          vcpusVal + 'vCPU',
          ramGB + 'GB',
          osVal,
          diskVal + 'GiB',
          gpuVal + 'GPU',
        ].join('-');

        instances.push({
          resourceType: 'VM',
          sku,
          perfClass: perfClassVal,
          vcpus: parseInt(vcpusVal, 10),
          ramGB,
          os: osVal,
          disk: parseInt(diskVal, 10),
          gpu: parseInt(gpuVal, 10),
          quantity: qty,
          cost: subtotal
        });

      } else {
        // gather Storage fields
        const sClass = storageClassEl.value;
        const sGiB = parseInt(storageGiBEl.value, 10);
        let rGiB = parseInt(retrievedGiBEl.value, 10);
        // if Standard is selected, retrieval is 0
        if (sClass === 'Standard') {
          rGiB = 0;
        }

        const subtotal = calculateStorageCost(sClass, sGiB, rGiB, qty);
        const sku = [
          'ObjectStorage',
          sClass,
          sGiB + 'GB',
          (sClass === 'ColdInstant' ? rGiB + 'GBRetrieved' : 'NoRetrieval'),
        ].join('-');

        instances.push({
          resourceType: 'ObjectStorage',
          sku,
          storageClass: sClass,
          storedGiB: sGiB,
          retrievedGiB: rGiB,
          quantity: qty,
          cost: subtotal
        });
      }

      renderTable();
    }

    function renderTable() {
      // clear existing rows
      instancesTableBody.innerHTML = '';

      let vmTotalCost = 0, vmTotalVcpus = 0, vmTotalRam = 0;
      let storageTotalCost = 0, storageTotalGiB = 0, storageTotalRetrieved = 0;
      let grandTotal = 0;

      instances.forEach((inst, idx) => {
        // create a row
        const tr = document.createElement('tr');

        // Resource Type
        const typeTd = document.createElement('td');
        typeTd.textContent = inst.resourceType;
        tr.appendChild(typeTd);

        // SKU
        const skuTd = document.createElement('td');
        skuTd.textContent = inst.sku;
        tr.appendChild(skuTd);

        // Quantity
        const qtyTd = document.createElement('td');
        qtyTd.textContent = inst.quantity;
        tr.appendChild(qtyTd);

        // Subtotal
        const costTd = document.createElement('td');
        costTd.textContent = 'R$' + inst.cost.toFixed(2);
        tr.appendChild(costTd);

        // Remove button
        const removeTd = document.createElement('td');
        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'X';
        removeBtn.addEventListener('click', () => {
          instances.splice(idx, 1);
          renderTable();
        });
        removeTd.appendChild(removeBtn);
        tr.appendChild(removeTd);

        instancesTableBody.appendChild(tr);

        // Now accumulate totals
        grandTotal += inst.cost;

        if (inst.resourceType === 'VM') {
          vmTotalCost += inst.cost;
          vmTotalVcpus += (inst.vcpus * inst.quantity);
          vmTotalRam += (inst.ramGB * inst.quantity);
        } else if (inst.resourceType === 'ObjectStorage') {
          storageTotalCost += inst.cost;
          storageTotalGiB += (inst.storedGiB * inst.quantity);
          if (inst.storageClass === 'ColdInstant') {
            storageTotalRetrieved += (inst.retrievedGiB * inst.quantity);
          }
        }
      });

      // Update summary
      vmTotalVcpusEl.textContent = vmTotalVcpus;
      vmTotalRamEl.textContent = vmTotalRam;
      vmTotalCostEl.textContent = 'R$' + vmTotalCost.toFixed(2);

      storageTotalGiBEl.textContent = storageTotalGiB;
      storageTotalRetrievedEl.textContent = storageTotalRetrieved;
      storageTotalCostEl.textContent = 'R$' + storageTotalCost.toFixed(2);

      grandTotalCostEl.textContent = 'R$' + grandTotal.toFixed(2);
    }

    addResourceBtn.addEventListener('click', addResource);

  </script>
</body>
</html>
