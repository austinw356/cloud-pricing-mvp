<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Magalu Cloud Pricing Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0 auto;
      max-width: 1200px;
      background: #f4f4f4;
      padding: 20px;
    }

    h1 {
      margin-top: 0;
    }
    .disclaimer {
      font-size: 0.9em;
      color: #555;
      margin-bottom: 20px;
    }
    
    /* BOXED SECTION for each resource type */
    .resource-section {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-bottom: 40px;
      padding: 20px;
    }
    .resource-section h2 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 1.3em;
      color: #333;
    }

    .section-form {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .field {
      margin-bottom: 16px;
      min-width: 300px;
    }
    label {
      display: inline-block;
      width: 200px;
      font-weight: bold;
      margin-bottom: 6px;
    }
    select, input[type="number"] {
      min-width: 100px;
      padding: 4px;
    }

    .price-display {
      margin-top: 6px;
      font-weight: bold;
      font-size: 1em;
      color: #007bff;
    }

    button {
      margin-top: 8px;
      padding: 6px 12px;
      cursor: pointer;
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
    }
    button:hover {
      background: #0056b3;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f9f9f9;
    }
    td button {
      background: #dc3545;
    }
    td button:hover {
      background: #a71d2a;
    }
    tfoot td {
      font-weight: bold;
      background: #f0f0f0;
    }

    .summary-section {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 16px;
      margin-top: 30px;
    }
    .summary-section p {
      margin: 8px 0;
      font-weight: bold;
      font-size: 1.1em;
    }
  </style>
</head>
<body>

  <h1>Magalu Cloud Pricing Calculator</h1>
  <p class="disclaimer">
    Prices shown are monthly estimates (billed by the second). Taxes included.
  </p>

  <!-- ************************************************** -->
  <!--                VIRTUAL MACHINES                   -->
  <!-- ************************************************** -->
  <div class="resource-section">
    <h2>Virtual Machines</h2>

    <div class="section-form">
      <div class="field">
        <label for="vmPerfClass">Performance Class:</label>
        <select id="vmPerfClass">
          <option value="BV">Balanced Value (BV)</option>
          <option value="DP">Dedicated Performance (DP)</option>
        </select>
      </div>

      <div class="field">
        <label for="vmOsType">OS Type:</label>
        <select id="vmOsType">
          <option value="Linux">Linux</option>
          <option value="Windows">Windows (+R$150/vCPU)</option>
        </select>
      </div>

      <div class="field">
        <label for="vmMemoryRatio">Memory Ratio (RAM / vCPU):</label>
        <select id="vmMemoryRatio">
          <!-- updated dynamically -->
        </select>
      </div>

      <div class="field">
        <label for="vmVcpus">VM Size (# of vCPUs):</label>
        <select id="vmVcpus">
          <!-- updated dynamically -->
        </select>
      </div>

      <div class="field">
        <label for="vmLocalDisk">Local Disk Size (GiB):</label>
        <select id="vmLocalDisk">
          <!-- updated dynamically -->
        </select>
      </div>

      <div class="field">
        <label for="vmGpu">Optional GPU:</label>
        <select id="vmGpu">
          <option value="0">No GPU</option>
          <option value="1">1x Nvidia L40 (+R$5110)</option>
          <option value="2">2x Nvidia L40 (+R$10220)</option>
        </select>
        <span id="vmGpuNote" style="color: #d00; margin-left: 10px;"></span>
      </div>

      <div class="field">
        <label for="vmQuantity">Quantity of Instances:</label>
        <input type="number" id="vmQuantity" value="1" min="1" />
      </div>
    </div>

    <!-- Display Price per Instance -->
    <div id="vmPricePerInstance" class="price-display">Price per Instance: R$0.00</div>

    <button id="addVmBtn">Add VM Configuration</button>

    <!-- VM Table -->
    <table id="vmTable">
      <thead>
        <tr>
          <th>SKU</th>
          <th>Perf Class</th>
          <th>vCPUs</th>
          <th>RAM (GB)</th>
          <th>OS</th>
          <th>Disk (GiB)</th>
          <th>GPU(s)</th>
          <th>Qty</th>
          <th>Subtotal (R$)</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody>
        <!-- VM rows here -->
      </tbody>
      <tfoot>
        <tr>
          <td colspan="2">Totals</td>
          <td id="vmSumVcpus">0</td>
          <td id="vmSumRam">0</td>
          <td></td>
          <td id="vmSumDisk">0</td>
          <td id="vmSumGpu">0</td>
          <td id="vmSumQty">0</td>
          <td id="vmSumSubtotal">R$0.00</td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- ************************************************** -->
  <!--                OBJECT STORAGE                     -->
  <!-- ************************************************** -->
  <div class="resource-section">
    <h2>Object Storage</h2>

    <div class="section-form">
      <div class="field">
        <label for="osClass">Storage Class:</label>
        <select id="osClass">
          <option value="Standard">Standard</option>
          <option value="ColdInstant">Cold Instant</option>
        </select>
        <!-- Unit price note -->
        <div id="osUnitPrice" class="price-display"></div>
      </div>

      <div class="field">
        <label for="osGiBs"># of GiBs (Storage):</label>
        <input type="number" id="osGiBs" value="500" min="1" />
      </div>

      <div class="field">
        <label for="osGiBsRetrieved">GiBs Retrieved per Month:</label>
        <input type="number" id="osGiBsRetrieved" value="100" min="0" />
      </div>
    </div>

    <button id="addObjectStorageBtn">Add Object Storage</button>

    <!-- Object Storage Table -->
    <table id="objectStorageTable">
      <thead>
        <tr>
          <th>SKU</th>
          <th>Class</th>
          <th>GiBs Stored</th>
          <th>GiBs Retrieved</th>
          <th>Subtotal (R$)</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody>
        <!-- Object Storage rows here -->
      </tbody>
      <tfoot>
        <tr>
          <td colspan="2">Totals</td>
          <td id="osSumStored">0</td>
          <td id="osSumRetrieved">0</td>
          <td id="osSumSubtotal">R$0.00</td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- ************************************************** -->
  <!--              BLOCK STORAGE VOLUMES               -->
  <!-- ************************************************** -->
  <div class="resource-section">
    <h2>Block Storage Volumes</h2>

    <div class="section-form">
      <div class="field">
        <label>Storage Class:</label>
        <input type="text" value="NVMe Standard" disabled />
      </div>

      <div class="field">
        <label for="bsIops">IOPS:</label>
        <select id="bsIops">
          <option value="1000">1K</option>
          <option value="5000">5K</option>
          <option value="10000">10K</option>
          <option value="15000">15K</option>
          <option value="20000">20K</option>
        </select>
        <!-- Unit price note -->
        <div id="bsUnitPrice" class="price-display"></div>
      </div>

      <div class="field">
        <label for="bsVolumeSize">Volume Size (GiB):</label>
        <input type="number" id="bsVolumeSize" value="250" min="10" max="1024" />
      </div>

      <div class="field">
        <label for="bsQuantity">Quantity of Volumes:</label>
        <input type="number" id="bsQuantity" value="1" min="1" />
      </div>
    </div>

    <button id="addBlockStorageBtn">Add Block Volume</button>

    <!-- Block Storage Table -->
    <table id="blockStorageTable">
      <thead>
        <tr>
          <th>SKU</th>
          <th>IOPS</th>
          <th>Size (GiB)</th>
          <th>Quantity</th>
          <th>Subtotal (R$)</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody>
        <!-- Block Storage rows here -->
      </tbody>
      <tfoot>
        <tr>
          <td>Totals</td>
          <td id="bsSumIops">0</td>
          <td id="bsSumSize">0</td>
          <td id="bsSumQty">0</td>
          <td id="bsSumSubtotal">R$0.00</td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <!-- ************************************************** -->
  <!--                    SUMMARY                         -->
  <!-- ************************************************** -->
  <div class="summary-section">
    <p>Virtual Machines: <span id="summaryVmSubtotal">R$0.00</span></p>
    <p>Object Storage: <span id="summaryObjectSubtotal">R$0.00</span></p>
    <p>Block Storage: <span id="summaryBlockSubtotal">R$0.00</span></p>
    <hr/>
    <p>Overall Monthly Total: <span id="overallTotal">R$0.00</span></p>
  </div>


  <script>
    // ---------------------------------------------------------
    //   1) Data/Utility for Virtual Machines
    // ---------------------------------------------------------
    const memoryRatiosBV = [1, 2, 4];
    const memoryRatiosDP = [2, 4, 8];
    const vcpusBV = [1, 2, 4, 8];
    const vcpusDP = [2, 4, 8, 16, 32];

    function getLocalDiskOptions(perfClass, os) {
      // BV + Linux => [10, 20, 40, 100]
      // BV + Windows => [40, 80, 160]
      // DP => [100, 150, 250]
      if (perfClass === 'BV') {
        if (os === 'Linux') {
          return [10, 20, 40, 100];
        } else {
          return [40, 80, 160];
        }
      } else {
        return [100, 150, 250];
      }
    }

    // VM cost formula
    // basePrice = 35 for 1 vCPU, memRatio=1, BV, Linux, 0 disk, 0 GPU
    // perfClassFactor = 1 for BV, 1.5 for DP
    // totalComputeCost = basePrice * perfClassFactor * vcpus * memRatio
    // Windows surcharge = 150 * vcpus
    // disk cost = (diskSize / 10) * 8
    // GPU cost = 5110 * numberOfGPUs
    // Multiply final by quantity
    function calculateVmCost(perfClass, memRatio, vcpus, os, diskSize, gpuCount, quantity) {
      const basePrice = 35;
      const perfClassFactor = (perfClass === 'BV') ? 1 : 1.5;
      const memoryRatioFactor = parseInt(memRatio, 10);
      const numVcpus = parseInt(vcpus, 10);
      const numDiskGiB = parseInt(diskSize, 10);
      const gpus = parseInt(gpuCount, 10);
      const qty = parseInt(quantity, 10);

      let computeCost = basePrice * perfClassFactor * numVcpus * memoryRatioFactor;

      let osSurcharge = 0;
      if (os === 'Windows') {
        osSurcharge = 150 * numVcpus;
      }

      let diskCost = (numDiskGiB / 10) * 8;
      let gpuCost = 5110 * gpus;

      let total = (computeCost + osSurcharge + diskCost + gpuCost) * qty;
      return total;
    }

    // For "Price per Instance" we compute the cost with quantity=1
    function calculateVmCostSingle(perfClass, memRatio, vcpus, os, diskSize, gpuCount) {
      return calculateVmCost(perfClass, memRatio, vcpus, os, diskSize, gpuCount, 1);
    }

    // VM lists & DOM references
    let vmList = [];
    const vmPerfClassEl = document.getElementById('vmPerfClass');
    const vmOsTypeEl = document.getElementById('vmOsType');
    const vmMemoryRatioEl = document.getElementById('vmMemoryRatio');
    const vmVcpusEl = document.getElementById('vmVcpus');
    const vmLocalDiskEl = document.getElementById('vmLocalDisk');
    const vmGpuEl = document.getElementById('vmGpu');
    const vmGpuNoteEl = document.getElementById('vmGpuNote');
    const vmQuantityEl = document.getElementById('vmQuantity');
    const addVmBtn = document.getElementById('addVmBtn');
    const vmTableBody = document.querySelector('#vmTable tbody');

    // Footer sums
    const vmSumVcpusEl = document.getElementById('vmSumVcpus');
    const vmSumRamEl = document.getElementById('vmSumRam');
    const vmSumDiskEl = document.getElementById('vmSumDisk');
    const vmSumGpuEl = document.getElementById('vmSumGpu');
    const vmSumQtyEl = document.getElementById('vmSumQty');
    const vmSumSubtotalEl = document.getElementById('vmSumSubtotal');

    // Price per instance display
    const vmPricePerInstanceEl = document.getElementById('vmPricePerInstance');

    function updateVmForm() {
      const perfClassVal = vmPerfClassEl.value;
      const osVal = vmOsTypeEl.value;

      // Memory ratio
      let ratios = (perfClassVal === 'BV') ? memoryRatiosBV : memoryRatiosDP;
      vmMemoryRatioEl.innerHTML = '';
      ratios.forEach(r => {
        const opt = document.createElement('option');
        opt.value = r;
        opt.textContent = r;
        vmMemoryRatioEl.appendChild(opt);
      });

      // vCPUs
      let vcpuOpts = (perfClassVal === 'BV') ? vcpusBV : vcpusDP;
      vmVcpusEl.innerHTML = '';
      vcpuOpts.forEach(v => {
        const opt = document.createElement('option');
        opt.value = v;
        opt.textContent = v;
        vmVcpusEl.appendChild(opt);
      });

      // Local Disk
      let diskOpts = getLocalDiskOptions(perfClassVal, osVal);
      vmLocalDiskEl.innerHTML = '';
      diskOpts.forEach(d => {
        const opt = document.createElement('option');
        opt.value = d;
        opt.textContent = d;
        vmLocalDiskEl.appendChild(opt);
      });

      // GPU logic
      let disableGPU = false;
      let note = '';
      if (perfClassVal === 'DP') {
        disableGPU = true;
        note = 'GPU not available on this performance class';
      } else if (osVal === 'Windows') {
        disableGPU = true;
        note = 'GPU not available with Windows';
      }
      vmGpuEl.disabled = disableGPU;
      if (disableGPU) {
        vmGpuEl.value = '0';
        vmGpuNoteEl.textContent = note;
      } else {
        vmGpuNoteEl.textContent = '';
      }

      // Also update the "Price per Instance"
      updateVmPricePerInstance();
    }

    // Price per instance: recalc whenever inputs change
    function updateVmPricePerInstance() {
      const perfClassVal = vmPerfClassEl.value;
      const osVal = vmOsTypeEl.value;
      const memRatioVal = vmMemoryRatioEl.value;
      const vcpusVal = vmVcpusEl.value;
      const diskVal = vmLocalDiskEl.value;
      const gpuVal = vmGpuEl.value;

      const singleCost = calculateVmCostSingle(
        perfClassVal,
        memRatioVal,
        vcpusVal,
        osVal,
        diskVal,
        gpuVal
      );
      vmPricePerInstanceEl.textContent = 'Price per Instance: R$' + singleCost.toFixed(2);
    }

    vmPerfClassEl.addEventListener('change', updateVmForm);
    vmOsTypeEl.addEventListener('change', updateVmForm);
    vmMemoryRatioEl.addEventListener('change', updateVmPricePerInstance);
    vmVcpusEl.addEventListener('change', updateVmPricePerInstance);
    vmLocalDiskEl.addEventListener('change', updateVmPricePerInstance);
    vmGpuEl.addEventListener('change', updateVmPricePerInstance);

    // Initial load
    updateVmForm();

    function addVmItem() {
      const perfClassVal = vmPerfClassEl.value;
      const osVal = vmOsTypeEl.value;
      const memRatioVal = vmMemoryRatioEl.value;
      const vcpusVal = vmVcpusEl.value;
      const diskVal = vmLocalDiskEl.value;
      const gpuVal = vmGpuEl.value;
      const qtyVal = vmQuantityEl.value;

      const subtotal = calculateVmCost(
        perfClassVal,
        memRatioVal,
        vcpusVal,
        osVal,
        diskVal,
        gpuVal,
        qtyVal
      );

      const ramGB = parseInt(memRatioVal, 10) * parseInt(vcpusVal, 10);
      const sku = [
        perfClassVal,
        vcpusVal + 'vCPU',
        ramGB + 'GB',
        osVal,
        diskVal + 'GiB',
        gpuVal + 'GPU',
        'Qty' + qtyVal
      ].join('-');

      vmList.push({
        sku,
        perfClass: perfClassVal,
        vcpus: parseInt(vcpusVal, 10),
        ramGB,
        os: osVal,
        disk: parseInt(diskVal, 10),
        gpu: parseInt(gpuVal, 10),
        quantity: parseInt(qtyVal, 10),
        subtotal
      });

      renderVmTable();
    }

    function renderVmTable() {
      vmTableBody.innerHTML = '';

      let sumVcpus = 0;
      let sumRam = 0;
      let sumDisk = 0;
      let sumGpu = 0;
      let sumQty = 0;
      let sumVmCost = 0;

      vmList.forEach((item, idx) => {
        const tr = document.createElement('tr');

        // SKU
        const skuTd = document.createElement('td');
        skuTd.textContent = item.sku;
        tr.appendChild(skuTd);

        // Perf Class
        const perfTd = document.createElement('td');
        perfTd.textContent = item.perfClass;
        tr.appendChild(perfTd);

        // vCPUs
        const vcpusTd = document.createElement('td');
        vcpusTd.textContent = item.vcpus;
        tr.appendChild(vcpusTd);

        // RAM
        const ramTd = document.createElement('td');
        ramTd.textContent = item.ramGB;
        tr.appendChild(ramTd);

        // OS
        const osTd = document.createElement('td');
        osTd.textContent = item.os;
        tr.appendChild(osTd);

        // Disk
        const diskTd = document.createElement('td');
        diskTd.textContent = item.disk;
        tr.appendChild(diskTd);

        // GPU
        const gpuTd = document.createElement('td');
        gpuTd.textContent = item.gpu;
        tr.appendChild(gpuTd);

        // Qty
        const qtyTd = document.createElement('td');
        qtyTd.textContent = item.quantity;
        tr.appendChild(qtyTd);

        // Subtotal
        const subtotalTd = document.createElement('td');
        subtotalTd.textContent = 'R$' + item.subtotal.toFixed(2);
        tr.appendChild(subtotalTd);

        // Remove
        const removeTd = document.createElement('td');
        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'X';
        removeBtn.addEventListener('click', () => {
          vmList.splice(idx, 1);
          renderVmTable();
        });
        removeTd.appendChild(removeBtn);
        tr.appendChild(removeTd);

        vmTableBody.appendChild(tr);

        // Accumulate
        sumVcpus += item.vcpus * item.quantity;
        sumRam += item.ramGB * item.quantity;
        sumDisk += item.disk * item.quantity;
        sumGpu += item.gpu * item.quantity;
        sumQty += item.quantity;
        sumVmCost += item.subtotal;
      });

      vmSumVcpusEl.textContent = sumVcpus;
      vmSumRamEl.textContent = sumRam;
      vmSumDiskEl.textContent = sumDisk;
      vmSumGpuEl.textContent = sumGpu;
      vmSumQtyEl.textContent = sumQty;
      vmSumSubtotalEl.textContent = 'R$' + sumVmCost.toFixed(2);

      updateSummary();
    }
    addVmBtn.addEventListener('click', addVmItem);


    // ---------------------------------------------------------
    //   2) Object Storage
    // ---------------------------------------------------------
    let objectStorageList = [];
    const osClassEl = document.getElementById('osClass');
    const osGiBsEl = document.getElementById('osGiBs');
    const osGiBsRetrievedEl = document.getElementById('osGiBsRetrieved');
    const addObjectStorageBtn = document.getElementById('addObjectStorageBtn');
    const objectStorageTableBody = document.querySelector('#objectStorageTable tbody');

    // Footer
    const osSumStoredEl = document.getElementById('osSumStored');
    const osSumRetrievedEl = document.getElementById('osSumRetrieved');
    const osSumSubtotalEl = document.getElementById('osSumSubtotal');

    // Unit price display
    const osUnitPriceEl = document.getElementById('osUnitPrice');

    // Pricing:
    // Standard: 0.10 R$/GB stored, no retrieval cost
    // Cold Instant: 0.06 R$/GB stored + 0.10 R$/GB retrieved
    function calculateObjectStorageCost(storageClass, giBs, giBsRetrieved) {
      let cost = 0;
      const stored = parseFloat(giBs);
      const retrieved = parseFloat(giBsRetrieved);

      if (storageClass === 'Standard') {
        cost = stored * 0.10; 
      } else {
        // Cold Instant
        cost = stored * 0.06 + retrieved * 0.10;
      }
      return cost;
    }

    function showObjectStorageUnitPrice() {
      const sc = osClassEl.value;
      if (sc === 'Standard') {
        osUnitPriceEl.textContent = 'R$0.10 per GiB stored (no retrieval fee)';
      } else {
        osUnitPriceEl.textContent = 'R$0.06 per GiB stored, plus R$0.10 per GiB retrieved';
      }
    }

    // Hide "GiBs Retrieved" if Standard is selected
    function handleOsClassChange() {
      if (osClassEl.value === 'Standard') {
        osGiBsRetrievedEl.value = '0';
        osGiBsRetrievedEl.disabled = true;
      } else {
        osGiBsRetrievedEl.disabled = false;
      }
      showObjectStorageUnitPrice();
    }

    osClassEl.addEventListener('change', handleOsClassChange);
    // Init
    handleOsClassChange();

    function addObjectStorageItem() {
      const sc = osClassEl.value;
      const giBsVal = osGiBsEl.value;
      const retrievedVal = osGiBsRetrievedEl.value;

      const subtotal = calculateObjectStorageCost(sc, giBsVal, retrievedVal);

      const sku = [
        sc,
        giBsVal + 'GiBs',
        (sc === 'ColdInstant') ? (retrievedVal + 'Retrieved') : 'NoRetrieval'
      ].join('-');

      objectStorageList.push({
        sku,
        storageClass: sc,
        giBs: parseInt(giBsVal, 10),
        giBsRetrieved: parseInt(retrievedVal, 10),
        subtotal
      });

      renderObjectStorageTable();
    }

    function renderObjectStorageTable() {
      objectStorageTableBody.innerHTML = '';
      let sumStored = 0;
      let sumRetrieved = 0;
      let sumCost = 0;

      objectStorageList.forEach((item, idx) => {
        const tr = document.createElement('tr');

        // SKU
        const skuTd = document.createElement('td');
        skuTd.textContent = item.sku;
        tr.appendChild(skuTd);

        // Class
        const classTd = document.createElement('td');
        classTd.textContent = item.storageClass;
        tr.appendChild(classTd);

        // GiBs Stored
        const giBsTd = document.createElement('td');
        giBsTd.textContent = item.giBs;
        tr.appendChild(giBsTd);

        // GiBs Retrieved
        const retrievedTd = document.createElement('td');
        if (item.storageClass === 'ColdInstant') {
          retrievedTd.textContent = item.giBsRetrieved;
        } else {
          retrievedTd.textContent = '0';
        }
        tr.appendChild(retrievedTd);

        // Subtotal
        const subtotalTd = document.createElement('td');
        subtotalTd.textContent = 'R$' + item.subtotal.toFixed(2);
        tr.appendChild(subtotalTd);

        // Remove
        const removeTd = document.createElement('td');
        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'X';
        removeBtn.addEventListener('click', () => {
          objectStorageList.splice(idx, 1);
          renderObjectStorageTable();
        });
        removeTd.appendChild(removeBtn);
        tr.appendChild(removeTd);

        objectStorageTableBody.appendChild(tr);

        // Accumulate
        sumStored += item.giBs;
        sumRetrieved += item.storageClass === 'ColdInstant' ? item.giBsRetrieved : 0;
        sumCost += item.subtotal;
      });

      osSumStoredEl.textContent = sumStored;
      osSumRetrievedEl.textContent = sumRetrieved;
      osSumSubtotalEl.textContent = 'R$' + sumCost.toFixed(2);

      updateSummary();
    }

    addObjectStorageBtn.addEventListener('click', addObjectStorageItem);


    // ---------------------------------------------------------
    //   3) Block Storage Volumes
    // ---------------------------------------------------------
    let blockStorageList = [];

    const bsIopsEl = document.getElementById('bsIops');
    const bsVolumeSizeEl = document.getElementById('bsVolumeSize');
    const bsQuantityEl = document.getElementById('bsQuantity');
    const addBlockStorageBtn = document.getElementById('addBlockStorageBtn');
    const blockStorageTableBody = document.querySelector('#blockStorageTable tbody');

    const bsSumIopsEl = document.getElementById('bsSumIops');
    const bsSumSizeEl = document.getElementById('bsSumSize');
    const bsSumQtyEl = document.getElementById('bsSumQty');
    const bsSumSubtotalEl = document.getElementById('bsSumSubtotal');
    const bsUnitPriceEl = document.getElementById('bsUnitPrice');

    function getBlockStoragePrice(iops) {
      const num = parseInt(iops, 10);
      if (num === 1000) return 0.58;
      if (num === 5000) return 0.65;
      if (num === 10000) return 0.73;
      if (num === 15000) return 0.81;
      if (num === 20000) return 0.89;
      return 0.58; // fallback
    }

    function showBlockStorageUnitPrice() {
      const currentIops = parseInt(bsIopsEl.value, 10);
      const unit = getBlockStoragePrice(currentIops);
      bsUnitPriceEl.textContent = `R$${unit.toFixed(2)} per GiB`;
    }

    bsIopsEl.addEventListener('change', showBlockStorageUnitPrice);

    // On load, show default
    showBlockStorageUnitPrice();

    function calculateBlockStorageCost(iops, volumeSize, quantity) {
      const costPerGiB = getBlockStoragePrice(iops);
      const size = parseFloat(volumeSize);
      const qty = parseInt(quantity, 10);
      return costPerGiB * size * qty;
    }

    function addBlockStorageItem() {
      const iopsVal = bsIopsEl.value;
      const sizeVal = bsVolumeSizeEl.value;
      const qtyVal = bsQuantityEl.value;

      const subtotal = calculateBlockStorageCost(iopsVal, sizeVal, qtyVal);
      const sku = [
        'NVMeStd', 
        iopsVal + 'IOPS', 
        sizeVal + 'GiB', 
        'Qty' + qtyVal
      ].join('-');

      blockStorageList.push({
        sku,
        iops: parseInt(iopsVal, 10),
        size: parseInt(sizeVal, 10),
        quantity: parseInt(qtyVal, 10),
        subtotal
      });

      renderBlockStorageTable();
    }

    function renderBlockStorageTable() {
      blockStorageTableBody.innerHTML = '';
      let sumIops = 0;
      let sumSize = 0;
      let sumQty = 0;
      let sumCost = 0;

      blockStorageList.forEach((item, idx) => {
        const tr = document.createElement('tr');

        // SKU
        const skuTd = document.createElement('td');
        skuTd.textContent = item.sku;
        tr.appendChild(skuTd);

        // IOPS
        const iopsTd = document.createElement('td');
        iopsTd.textContent = item.iops;
        tr.appendChild(iopsTd);

        // Size
        const sizeTd = document.createElement('td');
        sizeTd.textContent = item.size;
        tr.appendChild(sizeTd);

        // Quantity
        const qtyTd = document.createElement('td');
        qtyTd.textContent = item.quantity;
        tr.appendChild(qtyTd);

        // Subtotal
        const subtotalTd = document.createElement('td');
        subtotalTd.textContent = 'R$' + item.subtotal.toFixed(2);
        tr.appendChild(subtotalTd);

        // Remove
        const removeTd = document.createElement('td');
        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'X';
        removeBtn.addEventListener('click', () => {
          blockStorageList.splice(idx, 1);
          renderBlockStorageTable();
        });
        removeTd.appendChild(removeBtn);
        tr.appendChild(removeTd);

        blockStorageTableBody.appendChild(tr);

        // Accumulate
        sumIops += item.iops; 
        sumSize += (item.size * item.quantity);
        sumQty += item.quantity;
        sumCost += item.subtotal;
      });

      bsSumIopsEl.textContent = sumIops;
      bsSumSizeEl.textContent = sumSize;
      bsSumQtyEl.textContent = sumQty;
      bsSumSubtotalEl.textContent = 'R$' + sumCost.toFixed(2);

      updateSummary();
    }

    addBlockStorageBtn.addEventListener('click', addBlockStorageItem);

    // ---------------------------------------------------------
    //   4) Summary Calculation
    // ---------------------------------------------------------
    const summaryVmSubtotalEl = document.getElementById('summaryVmSubtotal');
    const summaryObjectSubtotalEl = document.getElementById('summaryObjectSubtotal');
    const summaryBlockSubtotalEl = document.getElementById('summaryBlockSubtotal');
    const overallTotalEl = document.getElementById('overallTotal');

    function updateSummary() {
      const vmCost = vmList.reduce((acc, item) => acc + item.subtotal, 0);
      const objectCost = objectStorageList.reduce((acc, item) => acc + item.subtotal, 0);
      const blockCost = blockStorageList.reduce((acc, item) => acc + item.subtotal, 0);
      const overall = vmCost + objectCost + blockCost;

      summaryVmSubtotalEl.textContent = 'R$' + vmCost.toFixed(2);
      summaryObjectSubtotalEl.textContent = 'R$' + objectCost.toFixed(2);
      summaryBlockSubtotalEl.textContent = 'R$' + blockCost.toFixed(2);
      overallTotalEl.textContent = 'R$' + overall.toFixed(2);
    }
  </script>
</body>
</html>
