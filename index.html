<!DOCTYPE html>
index.html
<html>
<head>
  <meta charset="utf-8" />
  <title>Magalu Cloud Pricing Calculator (Test)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px auto;
      max-width: 900px;
      background: #f4f4f4;
      padding: 20px;
    }

    h1 {
      margin-bottom: 8px;
    }

    .disclaimer {
      font-size: 0.9em;
      color: #555;
      margin-bottom: 20px;
    }

    .card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .card h2 {
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 1.2em;
      color: #333;
    }

    .field {
      margin-bottom: 16px;
    }
    label {
      display: inline-block;
      width: 220px;
      font-weight: bold;
      margin-bottom: 6px;
    }

    select, input[type="number"] {
      min-width: 150px;
      padding: 4px;
    }

    button {
      margin-top: 8px;
      padding: 6px 12px;
      cursor: pointer;
      background: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
    }
    button:hover {
      background: #0056b3;
    }

    .disabled {
      background-color: #ccc !important;
      cursor: not-allowed;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f9f9f9;
    }
    td button {
      background: #dc3545;
    }
    td button:hover {
      background: #a71d2a;
    }

    .totals-section {
      margin-top: 20px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 16px;
    }
    .totals-section p {
      margin: 0;
      padding: 4px 0;
      font-weight: bold;
    }
    .totals-section p span {
      float: right;
    }
  </style>
</head>
<body>

  <h1>Magalu Cloud Pricing Calculator (Test)</h1>
  <p class="disclaimer">
    Prices shown are monthly estimates (billed by the second). Taxes included.
  </p>

  <div class="card">
    <h2>Add a New Resource</h2>

    <!-- Only one resource type: Virtual Machines -->
    <div class="field">
      <label>Resource Type:</label>
      <select id="resourceType" disabled>
        <option value="VM" selected>Virtual Machines</option>
      </select>
    </div>

    <!-- Performance Class -->
    <div class="field">
      <label for="perfClass">Performance Class:</label>
      <select id="perfClass">
        <option value="BV">Balanced Value (BV)</option>
        <option value="DP">Dedicated Performance (DP)</option>
      </select>
    </div>

    <!-- OS Type (moved above Memory Ratio) -->
    <div class="field">
      <label for="osType">OS Type:</label>
      <select id="osType">
        <option value="Linux">Linux</option>
        <option value="Windows">Windows (+R$150/vCPU)</option>
      </select>
    </div>

    <!-- Memory Ratio -->
    <div class="field">
      <label for="memoryRatio">Memory Ratio (RAM / vCPU):</label>
      <select id="memoryRatio">
        <!-- Will update dynamically for BV or DP -->
      </select>
    </div>

    <!-- vCPUs -->
    <div class="field">
      <label for="vcpus">VM Size (# of vCPUs):</label>
      <select id="vcpus">
        <!-- Will update dynamically for BV or DP -->
      </select>
    </div>

    <!-- Local Disk -->
    <div class="field">
      <label for="localDisk">Local Disk Size (GiB):</label>
      <select id="localDisk">
        <!-- Will update dynamically -->
      </select>
    </div>

    <!-- GPU -->
    <div class="field">
      <label for="gpu">Optional GPU:</label>
      <select id="gpu">
        <option value="0">No GPU</option>
        <option value="1">1x Nvidia L40 (+R$5110)</option>
        <option value="2">2x Nvidia L40 (+R$10220)</option>
      </select>
      <span id="gpuNote" style="color: #d00; margin-left: 10px;"></span>
    </div>

    <!-- Quantity -->
    <div class="field">
      <label for="quantity">Quantity of Instances:</label>
      <input type="number" id="quantity" value="1" min="1" />
    </div>

    <!-- Button to add instance -->
    <button id="addInstanceBtn">Add This Configuration</button>
  </div>

  <!-- Table listing the chosen instances -->
  <table id="instancesTable">
    <thead>
      <tr>
        <th>SKU</th>
        <th>Perf Class</th>
        <th>vCPUs</th>
        <th>RAM (GB)</th>
        <th>OS</th>
        <th>Disk (GiB)</th>
        <th>GPU(s)</th>
        <th>Qty</th>
        <th>Subtotal (R$)</th>
        <th>Remove</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rows added dynamically -->
    </tbody>
  </table>

  <div class="totals-section">
    <!-- Subtotal for VMs (and later other resource types) -->
    <p>Virtual Machines: <span id="vmSubtotal">R$0.00</span></p>
    <p>Total Monthly Cost: <span id="totalMonthlyCost">R$0.00</span></p>
  </div>

  <script>
    // --------------------------------------------------------
    // 1) Data Definitions
    // --------------------------------------------------------

    // Balanced Value (BV) or Dedicated Performance (DP)
    const memoryRatiosBV = [1, 2, 4];
    const memoryRatiosDP = [2, 4, 8];

    const vcpusBV = [1, 2, 4, 8];
    const vcpusDP = [2, 4, 8, 16, 32];

    // Local disk options by combination (in GiB):
    // BV + Linux => [10, 20, 40, 100]
    // BV + Windows => [40, 80, 160]
    // DP (Linux or Windows) => [100, 150, 250]
    function getLocalDiskOptions(perfClass, os) {
      if (perfClass === 'BV') {
        if (os === 'Linux') {
          return [10, 20, 40, 100];
        } else {
          // Windows
          return [40, 80, 160];
        }
      } else {
        // DP (both OS)
        return [100, 150, 250];
      }
    }

    // HTML elements
    const perfClassEl = document.getElementById('perfClass');
    const osTypeEl = document.getElementById('osType');
    const memoryRatioEl = document.getElementById('memoryRatio');
    const vcpusEl = document.getElementById('vcpus');
    const localDiskEl = document.getElementById('localDisk');
    const gpuEl = document.getElementById('gpu');
    const gpuNoteEl = document.getElementById('gpuNote');
    const quantityEl = document.getElementById('quantity');

    // --------------------------------------------------------
    // 2) Update Form Fields Dynamically
    // --------------------------------------------------------
    function updateForm() {
      const currentPerfClass = perfClassEl.value;
      const currentOS = osTypeEl.value;

      // Memory ratios
      let ratios = (currentPerfClass === 'BV') ? memoryRatiosBV : memoryRatiosDP;
      memoryRatioEl.innerHTML = '';
      ratios.forEach(r => {
        const opt = document.createElement('option');
        opt.value = r;
        opt.textContent = r;
        memoryRatioEl.appendChild(opt);
      });

      // vCPUs
      let vcpuOpts = (currentPerfClass === 'BV') ? vcpusBV : vcpusDP;
      vcpusEl.innerHTML = '';
      vcpuOpts.forEach(v => {
        const opt = document.createElement('option');
        opt.value = v;
        opt.textContent = v;
        vcpusEl.appendChild(opt);
      });

      // Local disk
      let diskOpts = getLocalDiskOptions(currentPerfClass, currentOS);
      localDiskEl.innerHTML = '';
      diskOpts.forEach(d => {
        const opt = document.createElement('option');
        opt.value = d;
        opt.textContent = d;
        localDiskEl.appendChild(opt);
      });

      // GPU logic:
      // - If perfClass=DP => GPU not available
      // - If OS=Windows => GPU not available
      // So we disable the select and show a note accordingly.
      let disableGPU = false;
      let note = '';
      if (currentPerfClass === 'DP') {
        disableGPU = true;
        note = 'GPU not available on this performance class';
      } else if (currentOS === 'Windows') {
        disableGPU = true;
        note = 'GPU not available with Windows';
      }

      gpuEl.disabled = disableGPU;
      if (disableGPU) {
        gpuEl.value = '0'; // reset to no GPU
        gpuNoteEl.textContent = note;
      } else {
        gpuNoteEl.textContent = '';
      }
    }

    perfClassEl.addEventListener('change', updateForm);
    osTypeEl.addEventListener('change', updateForm);

    // Initialize
    updateForm();

    // --------------------------------------------------------
    // 3) Pricing Logic
    // --------------------------------------------------------
    /*
      basePrice = 35 for 1 vCPU, memRatio=1, BV, Linux, 0 disk, 0 GPU
      perfClassFactor = 1 for BV, 1.5 for DP
      totalComputeCost = basePrice * perfClassFactor * vcpus * memRatio
      Windows surcharge = 150 * vcpus (if OS=Windows)
      disk cost = (diskSize / 10) * 8
      GPU cost = 5110 * numberOfGPUs (only if not disabled)
      Then multiplied by quantity
    */
    function calculateCost(perfClass, memRatio, vcpus, os, diskSize, gpuCount, quantity) {
      const basePrice = 35;
      const perfClassFactor = (perfClass === 'BV') ? 1 : 1.5;
      const memoryRatioFactor = parseInt(memRatio, 10);
      const numVcpus = parseInt(vcpus, 10);
      const numDiskGiB = parseInt(diskSize, 10);
      const gpus = parseInt(gpuCount, 10);
      const qty = parseInt(quantity, 10);

      // compute cost
      let computeCost = basePrice * perfClassFactor * numVcpus * memoryRatioFactor;

      // Windows surcharge
      let osSurcharge = 0;
      if (os === 'Windows') {
        osSurcharge = 150 * numVcpus;
      }

      // Disk cost
      let diskCost = (numDiskGiB / 10) * 8;

      // GPU cost
      let gpuCost = 5110 * gpus; // if GPU is disabled, gpus=0

      // Sum up and then multiply by quantity
      let total = (computeCost + osSurcharge + diskCost + gpuCost) * qty;
      return total;
    }

    // --------------------------------------------------------
    // 4) Add Instances & Render Table
    // --------------------------------------------------------
    const addBtn = document.getElementById('addInstanceBtn');
    const instancesTableBody = document.querySelector('#instancesTable tbody');

    let instances = []; // each item => { resourceType, sku, perfClass, vcpus, ramGB, os, disk, gpu, quantity, subtotal }

    function addInstance() {
      const perfClassVal = perfClassEl.value;
      const osVal = osTypeEl.value;
      const memRatioVal = memoryRatioEl.value;
      const vcpusVal = vcpusEl.value;
      const diskVal = localDiskEl.value;
      const gpuVal = gpuEl.value;
      const quantityVal = quantityEl.value;

      // Calculate cost
      const subtotal = calculateCost(
        perfClassVal,
        memRatioVal,
        vcpusVal,
        osVal,
        diskVal,
        gpuVal,
        quantityVal
      );

      // Build a SKU string
      const ramGB = parseInt(vcpusVal, 10) * parseInt(memRatioVal, 10);
      const sku = [
        perfClassVal,
        vcpusVal + 'vCPU',
        ramGB + 'GB',
        osVal,
        diskVal + 'GiB',
        gpuVal + 'GPU',
        'Qty' + quantityVal
      ].join('-');

      const instanceItem = {
        resourceType: 'VM',
        sku,
        perfClass: perfClassVal,
        vcpus: vcpusVal,
        ramGB,
        os: osVal,
        disk: diskVal,
        gpu: gpuVal,
        quantity: parseInt(quantityVal, 10),
        subtotal
      };
      instances.push(instanceItem);

      // Re-render the table
      renderTable();
    }

    function renderTable() {
      instancesTableBody.innerHTML = '';

      let vmSum = 0;
      let grandTotal = 0;

      instances.forEach((inst, idx) => {
        const tr = document.createElement('tr');

        // SKU
        const skuTd = document.createElement('td');
        skuTd.textContent = inst.sku;
        tr.appendChild(skuTd);

        // PerfClass
        const perfTd = document.createElement('td');
        perfTd.textContent = inst.perfClass;
        tr.appendChild(perfTd);

        // vCPUs
        const vcpusTd = document.createElement('td');
        vcpusTd.textContent = inst.vcpus;
        tr.appendChild(vcpusTd);

        // RAM
        const ramTd = document.createElement('td');
        ramTd.textContent = inst.ramGB;
        tr.appendChild(ramTd);

        // OS
        const osTd = document.createElement('td');
        osTd.textContent = inst.os;
        tr.appendChild(osTd);

        // Disk
        const diskTd = document.createElement('td');
        diskTd.textContent = inst.disk;
        tr.appendChild(diskTd);

        // GPU
        const gpuTd = document.createElement('td');
        gpuTd.textContent = inst.gpu;
        tr.appendChild(gpuTd);

        // Quantity
        const qtyTd = document.createElement('td');
        qtyTd.textContent = inst.quantity;
        tr.appendChild(qtyTd);

        // Subtotal
        const subtotalTd = document.createElement('td');
        subtotalTd.textContent = 'R$' + inst.subtotal.toFixed(2);
        tr.appendChild(subtotalTd);

        // Remove button
        const removeTd = document.createElement('td');
        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'X';
        removeBtn.addEventListener('click', () => {
          instances.splice(idx, 1);
          renderTable();
        });
        removeTd.appendChild(removeBtn);
        tr.appendChild(removeTd);

        instancesTableBody.appendChild(tr);

        // Summation
        grandTotal += inst.subtotal;
        if (inst.resourceType === 'VM') {
          vmSum += inst.subtotal;
        }
      });

      // Update sub-totals and total cost
      document.getElementById('vmSubtotal').textContent = 'R$' + vmSum.toFixed(2);
      document.getElementById('totalMonthlyCost').textContent = 'R$' + grandTotal.toFixed(2);
    }

    addBtn.addEventListener('click', addInstance);

  </script>
</body>
</html>
